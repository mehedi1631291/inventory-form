<!DOCTYPE html>
<html>
	<head>
		<title>installation form</title>
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<link rel="stylesheet" type="text/css" href="css/general.css">

		<style>
			body {
				background-color: aliceblue;
				padding: 40px;
			}
			h2 {
				border-style: double;
				border-top: 0px;
				border-left: 0px;
				border-right: 0px;
				border-color: rgb(104, 86, 64);
				color: rgb(104, 86, 64);
			}
			a {
				color: inherit;
			}
			a {
				background-color: transparent;
			}

			table {
				width:100%;
			}
			table, th, td {
				border: 0px;
				border-collapse: collapse;
			}
			th, td, h2 {
				padding: 15px;
				text-align: center;
			}

			select{
				text-align: left !important;
			}
			

			.button_area a {
				text-decoration: none;
				color: unset;
				padding: 12px;
				font-size: 25px;
				display: inline-block;
				background: transparent;
		
			}
			.button_area .btn_hvr:hover {
				color: white;
			}

			h4 {
				font-size: 20px;
			}


			input {
				float: right;
				padding-left: 40px;
				padding-right: 40px;
				padding-top: 13px;
				padding-bottom: 13px;
				width: 70%;
			}

			select {
				float: right;
				padding-left: 40px;
				padding-top: 13px;
				padding-bottom: 13px;
				width: 70%;
			}
			h4{
				float: left;
			}

			h4, h2{
				font-family: "Segoe UI",Arial,sans-serif;
				font-weight: 400;
				margin: 10px 0;
			}

			#t01 th {
				background-color: black;
				color: white;
			}
		</style>
	</head>
	<body>
		<a id="back" href="menu.html">&#8592;Menu</a>
		<h2>Replacement Form</h2>

		<div class="button_area">
			<table>
				<tr>
					<td>
						<h4>Device IMEI:</h4>
						<input type="text" id="device_imei" placeholder="Your Answer">

					</td>
				</tr>

				<tr>
					<td>
						<h4>VTS Sim Number:</h4>
						<input type="text" id="vts_sim_nmbr" placeholder="Your Answer">

					</td>
				</tr>

				<tr>
					<td>
						<h4>Organization Name:</h4>
						<input type="text" id="org_name" placeholder="Your Answer">

					</td>
				</tr>

				<tr>
					<td>
						<h4>Vehicle Number:</h4>
						<input type="text" id="vehicle_nmbr" placeholder="Your Answer">

					</td>
				</tr>

				<tr>
					<td>
						<h4>Vehicle type:</h4>
						<select id="vehicle_type">

						</select>

					</td>
				</tr>

				<tr>
					<td>
						<h4>Installation Date</h4>
						<input type="date" id="installation_date" placeholder="Your Answer">

					</td>
				</tr>

				<tr>
					<td>
						<h4>Technician Name:</h4>
						<select id="technician_name">

						</select>

					</td>
				</tr>

				<tr>
					<td>
						<h4>Relay Interested?</h4>
						<select id="relay_interested">
							<option value="1">Yes</option>
							<option value="0">No</option>
						</select>

					</td>
				</tr>

				<tr>
					<td>
						<h4>Provider:</h4>
						<select id="provider">

						</select>

					</td>
				</tr>
				<tr id="ten_row" hidden>
					<td>
						<h4>Tenant:</h4>
						<select id="ten">

						</select>

					</td>
				</tr>

				<tr>
					<td>
						<h4>Customer Category:</h4>
						<select id="cus_cat">

						</select>

					</td>
				</tr>

				<tr>
					<td>
						<h4>Client Type:</h4>
						<select id="cli_typ">

						</select>

					</td>
				</tr>

				<tr id="pac_row" hidden>
					<td>
						<h4>Package Type:</h4>
						<select id="pac_typ">

						</select>

					</td>
				</tr>

				<tr id="bil_amnt_row" hidden>
					<td>
						<h4>Bill Amount:</h4>
						<input type="text" id="bil_amnt" placeholder="Your Answer">

					</td>
				</tr>

				<tr id="code_sos_row" hidden>
					<td>
						<h4>Code/SOS:</h4>
						<input type="text" id="code_sos" placeholder="Your Answer">

					</td>
				</tr>

				<tr id="order_row" hidden>
					<td>
						<h4>Order:</h4>
						<input type="text" id="order" placeholder="Your Answer">

					</td>
				</tr>

				<tr id="bill_id_row" hidden>
					<td>
						<h4>Bill Id:</h4>
						<input type="text" id="bill_id" placeholder="Your Answer">

					</td>
				</tr>

				<tr id="sub_c_row" hidden>
					<td>
						<h4>Subscription:</h4>
						<input type="text" id="sub_c" placeholder="Your Answer">

					</td>
				</tr>

				<tr id="bill_period_row" hidden>
					<td>
						<h4>Bill period:</h4>
						<input type="text" id="bill_period" placeholder="Your Answer">

					</td>
				</tr>

				<tr>
					<td>
						<h4>Customer Email:</h4>
						<input type="text" id="Cus_email" placeholder="Your Answer">

					</td>
				</tr>

				<tr>
					<td>
						<h4>Customer Phone:</h4>
						<input type="text" id="cus_ph" placeholder="Your Answer">

					</td>
				</tr>
				<td >
					<a class="btn_hvr" style="background-color: rgb(187, 180, 180); padding-left: 45px; padding-right: 45px;">
						submit
					</a>
				</td>
			</table>

			<h2>Search Result</h2>
			<table id="t01" >
				<tr>
				  <th>IMEI</th>
				  <th>Result</th> 
				</tr>
			</table>
		</div>
		<div id="modal01" class="w3-modal">
			<div class="loader"></div>
		</div>
	</body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="js/general.js"></script>
	<script>
		$(document).ready(function(){
			var username= getCookie("username");
			
			if(username){
				try {
					//initializer
					var formInitData=JSON.parse(getCookie("installFormField"));
					var technician=(formInitData["technician"]).split(",");
					var clientType=(formInitData["clientType"]).split(",");
					var customerCategory=(formInitData["customerCategory"]).split(",");
					var provider=(formInitData["provider"]).split(",");
					var tenant=(formInitData["tenant"]).split(",");
					var vehicle=(formInitData["vehicle"]).split(",");
					var package=(formInitData["package"]).split(",");

					technician.forEach(element => {
						$('#technician_name').append(new Option(element, element));
					});

					clientType.forEach(element => {
						$('#cli_typ').append(new Option(element, element));
					});
					customerCategory.forEach(element => {
						$('#cus_cat').append(new Option(element, element));
					});
					provider.forEach(element => {
						$('#provider').append(new Option(element, element));
					});
					tenant.forEach(element => {
						$('#ten').append(new Option(element, element));
					});
					vehicle.forEach(element => {
						$('#vehicle_type').append(new Option(element, element));
					});
					package.forEach(element => {
						$('#pac_typ').append(new Option(element, element));
					});
					setFormOptional();
					
				} catch (error) {
					alert(error);
					var url = (window.location.href).replace("Installation_Complete_Form.html","menu.html");
					window.location.href = url;
				}
				

				$('#provider').change(function(){
					setFormOptional();
				});
				$('#ten').change(function(){
					setFormOptional();
				});

				$('#cus_cat').change(function(){
					setFormOptional();
				});


				var url="https://script.google.com/macros/s/AKfycbztzhckottKXPneR2cJc0dej24bcEiGfi-P7i3XERz_mIswHps5mKic/exec";
				$(".btn_hvr").on('click',function(){
					if (checkFields())
					{
						$("#modal01")[0].style.display='block';
						$.ajax({
							url: url, 
							type : "POST",
							headers: {
								'Content-Type': 'application/x-www-form-urlencoded'
							},
							//dataType : 'json', //"reqType:SI;email:"+
							data : {"reqType":"SD", "imeis":data},
							success : function(result) {
								
								tableRowNo = $("#t01 tr").length;
								for (let index = 1; index < tableRowNo; index++) {
									$('#t01 tr:last-child').remove();
								}
								//console.log(result);
								$("#IMEI")[0].value="";
								tableBody = $("#t01 tbody");
								Object.entries(result["resultData"]).forEach(([key, value]) => {
									//console.log(key, value);
									markup = "<tr><td>"+ key + "</td><td>"+value+"</td></tr>"; 
									tableBody.append(markup);
									$("#modal01")[0].style.display='none';
								});
								
							},
							error: function(xhr, resp, text) {
								//console.log(xhr, resp, text);
								alert(resp);
							}
						});
					}
				});
			}
			else{
				$("body")[0].innerHTML="";
				alert("Invalid Cookie. Please login First")
				var url = (window.location.href).replace("Installation_Complete_Form.html","index.html");
				window.location.href = url;
			}

			function getData(){
				var data={};
				data["reqType"]		=	"PD";
				data["formName"]	=	"installation";
				data["person"]		=	username;
				data["imei"]		=	$("#device_imei")[0].value;
				data["sim"]			=	$("#vts_sim_nmbr")[0].value;
				data["org"]			=	$("#org_name")[0].value;
				data["vehicleNum"]	=	$("#vehicle_nmbr")[0].value;
				data["vehicleType"]	=	$("#vehicle_type").val();
				data["installDate"]	=	$("#installation_date")[0].value;
				data["technician"]	=	$("#technician_name").val();
				data["relay"]		=	$("#relay_interested").val();
				data["provider"]	=	$("#provider").val();
				data["cusCat"]		=	$("#cus_cat").val();
				data["clientType"]	=	$("#cli_typ").val();
				data["cusEmail"]	=	$("#Cus_email")[0].value;
				data["cusPhn"]		=	$("#cus_ph")[0].value;
				data["time"]		=	new Date().getTime();

				if(!$("#pac_row").prop('hidden'))
				{
					data["package"]	=	$("#pac_typ").val();
				}
				if(!$("#ten_row").prop('hidden'))
				{
					data["tenant"]	=	$("#ten").val();
				}
				if(!$("#bil_amnt_row").prop('hidden'))
				{
					data["bilAmnt"]	=	$("#bil_amnt")[0].value;
				}
				if(!$("#code_sos_row").prop('hidden'))
				{
					data["codeSos"]		=	$("#code_sos")[0].value;
				}
				if(!$("#order_row").prop('hidden'))
				{
					data["order"]		=	$("#order")[0].value;
				}
				if(!$("#bill_id_row").prop('hidden'))
				{
					data["billId"]		=	$("#bill_id")[0].value;
				}
				if(!$("#sub_c_row").prop('hidden'))
				{
					data["subscription"]=	$("#sub_c")[0].value;
				}
				if(!$("#bill_period_row").prop('hidden'))
				{
					data["billPeriod"]	=	$("#bill_period")[0].value;
				}

				return data;
			}

			function checkFields(){
				if($("#device_imei")[0].value=="")
				{
					alert("Please complete the form");
					$("#device_imei")[0].focus();
					return false;
				}
				else if($("#vts_sim_nmbr")[0].value=="")
				{
					alert("Please complete the form");
					$("#vts_sim_nmbr")[0].focus();
					return false;
				}
				else if($("#org_name")[0].value=="")
				{
					alert("Please complete the form");
					$("#org_name")[0].focus();
					return false;
				}
				else if($("#vehicle_nmbr")[0].value=="")
				{
					alert("Please complete the form");
					$("#vehicle_nmbr")[0].focus();
					return false;
				}
				else if($("#installation_date")[0].value=="")
				{
					alert("Please complete the form");
					$("#installation_date")[0].focus();
					return false;
				}
				else if($("#bil_amnt")[0].value=="" && !$("#bil_amnt_row").prop('hidden'))
				{
					alert("Please complete the form");
					$("#bil_amnt")[0].focus();
					return false;
				}
				else if($("#code_sos")[0].value=="" && !$("#code_sos_row").prop('hidden'))
				{
					alert("Please complete the form");
					$("#code_sos")[0].focus();
					return false;
				}
				else if($("#order")[0].value=="" && !$("#order_row").prop('hidden'))
				{
					alert("Please complete the form");
					$("#order")[0].focus();
					return false;
				}
				else if($("#bill_id")[0].value=="" && !$("#bill_id_row").prop('hidden'))
				{
					alert("Please complete the form");
					$("#bill_id")[0].focus();
					return false;
				}
				else if($("#sub_c")[0].value=="" && !$("#sub_c_row").prop('hidden'))
				{
					alert("Please complete the form");
					$("#sub_c")[0].focus();
					return false;
				}
				else if($("#bill_period")[0].value=="" && !$("#bill_period_row").prop('hidden'))
				{
					alert("Please complete the form");
					$("#bill_period")[0].focus();
					return false;
				}
				else if($("#Cus_email")[0].value=="")
				{
					alert("Please complete the form");
					$("#Cus_email")[0].focus();
					return false;
				}
				else if($("#cus_ph")[0].value=="")
				{
					alert("Please complete the form");
					$("#cus_ph")[0].focus();
					return false;
				}
				else{
					return true;
				}	
			}

			function setFormOptional(){
				if($('#cus_cat').val()=="Consumer" && $('#provider').val()=="Dingi" && $('#ten').val()=="Dingi"){
					$("#ten_row").prop('hidden', false);
					$("#pac_row").prop('hidden', true);
					$("#bil_amnt_row").prop('hidden', false);
					$("#code_sos_row").prop('hidden', false);
					$("#order_row").prop('hidden', false);
					$("#bill_id_row").prop('hidden', false);
					$("#sub_c_row").prop('hidden', false);
					$("#bill_period_row").prop('hidden', false);
				}
				else if($('#provider').val()=="Dingi"){
					$("#ten_row").prop('hidden', false);
					$("#pac_row").prop('hidden', true);
					$("#bil_amnt_row").prop('hidden', true);
					$("#code_sos_row").prop('hidden', true);
					$("#order_row").prop('hidden', true);
					$("#bill_id_row").prop('hidden', true);
					$("#sub_c_row").prop('hidden', true);
					$("#bill_period_row").prop('hidden', true);
				}
				else if($('#provider').val()=="GP"){
					$("#ten_row").prop('hidden', true);
					$("#pac_row").prop('hidden', false);
					$("#bil_amnt_row").prop('hidden', true);
					$("#code_sos_row").prop('hidden', true);
					$("#order_row").prop('hidden', true);
					$("#bill_id_row").prop('hidden', true);
					$("#sub_c_row").prop('hidden', true);
					$("#bill_period_row").prop('hidden', true);
				}
				else{
					$("#ten_row").prop('hidden', true);
					$("#pac_row").prop('hidden', true);
					$("#bil_amnt_row").prop('hidden', true);
					$("#code_sos_row").prop('hidden', true);
					$("#order_row").prop('hidden', true);
					$("#bill_id_row").prop('hidden', true);
					$("#sub_c_row").prop('hidden', true);
					$("#bill_period_row").prop('hidden', true);
				}
			}
			
		});
	</script>
</html>